var caldoza_item_control_modal,caldoza_item_control_modal_handler;!function(a){function b(a,b,c){a.slideUp(function(){a.remove(),e(b)}),caldozaApi.data.sync&&caldozaApi.data.sync[c]&&delete caldozaApi.data.sync[c],sync_rebuild_nav()}var c={};flush_current=!1,caldoza_item_control_modal=function(b){var d,e,f=a("#"+b.modal+"-tmpl"),g=Handlebars.compile(f.html()),h={};return c[b.modal]&&flush_current===!1?(h={config:c[b.modal].data("config")},d="add"):(flush_current=!1,c[b.modal]=!1,d="update",h=b.trigger.data("default")),e=a(g(h)),e.find("[data-default]").each(function(){var b=a(this);b.val(b.data("default"))}),a("#"+b.modal+'_caldozaModal .caldoza-modal-footer [data-state="'+d+'"]').remove(),e},caldoza_item_control_modal_handler=function(b,f){var g,h=d(f.params.requestData.control,b.data);c[f.params.requestData.control+"-config"]?(g=c[f.params.requestData.control+"-config"],c[f.params.requestData.control+"-config"]=null,g.replaceWith(h)):(g=a("#"+f.params.requestData.control),h.appendTo(g)),e(a("#"+f.params.requestData.control))};var d=function(b,c){var d=a("#"+b+"-tmpl"),e=Handlebars.compile(d.html()),f=a(e(c));return f.data("config",c),a(document).trigger("caldoza.init"),f},e=function(b){var c;c=a(b?b:".caldoza-control-item");for(var d=0;d<c.length;d++){for(var e=a(c[d]),f=a("#"+e.prop("id")+"-control"),g=e.find(".caldoza-item"),h=[],i=0;i<g.length;i++){var j=a(g[i]);h.push(j.data("config"))}f.val(JSON.stringify(h)).trigger("change")}a(document).trigger("caldoza.save")};a(document).on("click",".caldoza-item-edit",function(){var b=a(this),d=b.closest(".caldoza-control-item"),e=d.prop("id")+"-config",f=a('button[data-modal="'+e+'"]');c[e]=b.closest(".caldoza-item"),flush_current=!1,f.trigger("click")}),a(document).on("click",".caldoza-item-delete",function(){var b=a(this),c=b.data("row"),d=a('.caldoza-item-primary-row[data-row="'+c+'"]'),e=a('.caldoza-item-delete-confirm[data-row="'+c+'"]');d.slideUp(),e.slideDown()}),a(document).on("click",".caldoza-item-delete-cancel",function(){var b=a(this),c=b.data("row"),d=a('.caldoza-item-primary-row[data-row="'+c+'"]'),e=a('.caldoza-item-delete-confirm[data-row="'+c+'"]');d.slideDown(),e.slideUp()}),a(document).on("click",".caldoza-item-remove",function(){var d=a(this),e=d.closest(".caldoza-control-item"),f=e.prop("id")+"-config",g=(a('button[data-modal="'+f+'"]'),d.parent().find("[data-for]")),h=d.closest(".caldoza-item"),i=g.data("for"),j=a('.caldoza-item-delete-confirm[data-row="'+i+'"]'),k=a('.caldoza-item-delete-progress[data-row="'+i+'"]');(!d.data("confirm")||confirm(d.data("confirm")))&&(c[f]=null,g.prop("checked")?(j.slideUp(),k.slideDown(),a.post(ajaxurl,{action:"caldoza_clear_type_data",slug:i},function(a){b(h,e,i)})):a.post(ajaxurl,{action:"caldoza_remove_type",slug:i},function(a){b(h,e,i)}))}),a(window).on("modals.closed",function(){flush_current=!0}),a(window).load(function(){a(document).on("caldoza.init",function(){a(".caldoza-control-item").not("._caldoza_item_init").each(function(){var b,c=a(this),e=a("#"+c.prop("id")+"-control");if(!c.hasClass("_caldoza_item_init")){c.addClass("_caldoza_item_init");try{b=JSON.parse(e.val())}catch(f){}if(c.addClass("_caldoza_item_init"),"object"==typeof b&&b.length)for(var g=0;g<b.length;g++){var h=d(c.prop("id"),b[g]);h.appendTo(c)}c.removeClass("processing"),a(document).trigger("caldoza.itemsLoaded")}})})})}(jQuery);